<mat-progress-bar *ngIf="loadingState; else ordersBlock" mode="indeterminate"></mat-progress-bar>
<ng-template #ordersBlock>
  <div class="container pb-3">
    <form [formGroup]="orderForm">
      <h2 class="pt-3 mb-3 d-flex">
        New order
      </h2>
      <div class="row">
        <div class="col-5">
          <h3 class="pb-2">Billing information's</h3>
          <div class="row">
            <div class="col-6">
              <mat-form-field appearance="outline">
                <mat-label>First Name</mat-label>
                <input autocomplete="given-name" formControlName="first_name" matInput required>
                <mat-error
                  *ngIf="orderForm.controls.first_name.invalid">{{ orderForm.controls.first_name.errors?.required ? 'First Name is required' : '' }}
                </mat-error>
              </mat-form-field>
            </div>

            <div class="col-6">
              <mat-form-field appearance="outline">
                <mat-label>Last Name</mat-label>
                <input autocomplete="family-name" formControlName="last_name" matInput required>
                <mat-error
                  *ngIf="orderForm.controls.last_name.invalid">{{ orderForm.controls.last_name.errors?.required ? 'Last Name is required' : '' }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="col-6">
              <mat-form-field appearance="outline">
                <mat-label>Email</mat-label>
                <input autocomplete="email" formControlName="email" matInput required>
                <mat-error
                  *ngIf="orderForm.controls.email.invalid">{{ orderForm.controls.email.errors?.required ? 'Email is required' : 'Invalid email' }}
                </mat-error>
              </mat-form-field>

            </div>
            <div class="col-6">
              <mat-form-field appearance="outline">
                <mat-label>Phone Number</mat-label>
                <span matPrefix style="line-height: 27px; vertical-align: text-bottom;">+&nbsp;</span>
                <input autocomplete="tel" formControlName="phone_number" matInput placeholder="421 944 123 456"
                       required>
                <mat-error
                  *ngIf="orderForm.controls.phone_number.invalid">{{ orderForm.controls.phone_number.errors?.required ? 'Phone Number is required' : '' }}
                </mat-error>
              </mat-form-field>

            </div>
            <div class="col-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Address</mat-label>
                <input autocomplete="address-line1" formControlName="address" matInput required>
                <mat-error
                  *ngIf="orderForm.controls.address.invalid">{{ orderForm.controls.address.errors?.required ? 'Address is required' : '' }}
                </mat-error>
              </mat-form-field>

            </div>
            <div class="col-4">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>ZIP Code</mat-label>
                <input autocomplete="postal-code" formControlName="zip_code" matInput required>
                <mat-error
                  *ngIf="orderForm.controls.zip_code.invalid">{{ orderForm.controls.zip_code.errors?.required ? 'ZIP Code is required' : '' }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="col-8">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>City</mat-label>
                <input autocomplete="address-level2" formControlName="city" matInput required>
                <mat-error
                  *ngIf="orderForm.controls.city.invalid">{{ orderForm.controls.city.errors?.required ? 'City is required' : '' }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="col-12">
              <mat-form-field appearance="outline">
                <mat-label>Country</mat-label>
                <mat-select formControlName="country">
                  <mat-option *ngFor="let country of countries" [value]="country.code">
                    {{ country.name }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="orderForm.controls.country.invalid">{{ orderForm.controls.country.errors?.required ? 'Country is required' : '' }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="col-12 mb-5">
              <div *ngIf="authenticationService.organization != null" class="col-6">
                <mat-slide-toggle class="pt-3" color="primary" formControlName="order_as_organization">
                  Buy to {{ authenticationService.organization.name }}
                </mat-slide-toggle>
              </div>
            </div>
          </div>
        </div>
        <div class="col-7">
          <h3 class="pb-2">Cart summary</h3>
          <mat-table [dataSource]="cartService.cartItems" class="mat-elevation-z3">
            <ng-container matColumnDef="name">
              <mat-header-cell *matHeaderCellDef mat-header-cell>Item name</mat-header-cell>
              <mat-cell *matCellDef="let item" mat-cell>
                <span *ngIf="item.core">
                  {{ item.core?.name || 'Unknown IP core' }}
                </span>
                <span *ngIf="item.package_id">
                  {{ item.package_id?.name || 'Unknown package' }}
                </span>
              </mat-cell>
              <mat-footer-cell *matFooterCellDef mat-footer-cell><b>Total price</b></mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="variation">
              <mat-header-cell *matHeaderCellDef mat-header-cell> Core variation</mat-header-cell>
              <mat-cell *matCellDef="let item" [ngSwitch]="item.variation" mat-cell>
                <span *ngIf="item.core">
                  <span *ngSwitchCase="'WITH_UPDATES'">With updates</span>
                  <span *ngSwitchCase="'WITHOUT_UPDATES'">Without updates</span>
                  <span *ngSwitchCase="'UPGRADE'">Upgrade</span>
                </span>
                <span *ngIf="item.package_id">
                    -
                </span>
              </mat-cell>
              <mat-footer-cell *matFooterCellDef></mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="price">
              <mat-header-cell *matHeaderCellDef mat-header-cell> Price without VAT</mat-header-cell>
              <mat-cell *matCellDef="let item" mat-cell> {{ item.price | priceFormat }}</mat-cell>
              <mat-footer-cell *matFooterCellDef>{{ cartService.totalPrice | priceFormat }}</mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="tax_price">
              <mat-header-cell *matHeaderCellDef mat-header-cell> Price</mat-header-cell>
              <mat-cell *matCellDef="let item" mat-cell> {{ item.tax_price | priceFormat }}</mat-cell>
              <mat-footer-cell *matFooterCellDef>{{ cartService.totalTaxPrice | priceFormat }}</mat-footer-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="['name', 'variation', 'price', 'tax_price']"></mat-header-row>
            <mat-row *matRowDef="let row; columns: ['name', 'variation', 'price', 'tax_price'];"></mat-row>
            <mat-footer-row *matFooterRowDef="['name', 'variation', 'price', 'tax_price']"></mat-footer-row>
          </mat-table>
        </div>
        <div class="col-12">
          <h3 class="pb-2">Payment method</h3>
          <mat-radio-group [formControlName]="'payment_method'">
            <div *ngFor="let paymentMethod of paymentMethods">
              <mat-radio-button [matTooltip]="paymentMethod.description" [value]="paymentMethod.namespace"
                                color="primary"
                                matTooltipPosition="right">
                <!--                <h4>{{paymentMethod.name}}</h4>-->
                <!--                <p>{{paymentMethod.description}}</p>-->
                <img [src]="paymentMethod.logo" alt="{{paymentMethod.name}} logo" style="height: 50px;">
              </mat-radio-button>
            </div>
          </mat-radio-group>
        </div>
        <div class="col-12 d-flex justify-content-end">
          <button (click)="createOrder()"
                  [disabled]="orderForm.invalid || loadingState || paymentMethods.length === 0 || order != null"
                  color="primary"
                  mat-raised-button
                  type="submit">
            Create order and pay {{ cartService.totalTaxPrice | priceFormat }}
          </button>
        </div>
      </div>


    </form>
  </div>
</ng-template>
